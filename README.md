# EscapeIsekai
  # 1️. 프로젝트 개요
### ※ 프로젝트 명 : EscapeIsekai(이세계 탈출기)
### ※ 구성원 소개
<img src="https://img.shields.io/badge/팀장 : 윤지석-5056E5?style=for-the-badge&logo=googlebard&logoColor=white" /><br/>
[blog](https://jiseoksblog.tistory.com/) [Github](https://github.com/noyyo)<br/>



<img src="https://img.shields.io/badge/부팀장 : 신현주-FFB71B?style=for-the-badge&logo=googlebard&logoColor=purple" /><br/>
[blog](https://hyunju9908.tistory.com/) [Github](https://github.com/Shyunju)<br/>



<img src="https://img.shields.io/badge/김도현-FFFF66?style=for-the-badge&logo=googlebard&logoColor=yellow" /><br/>
[blog](https://velog.io/@kimhitori) [Github](https://github.com/subscriptioncat)<br/>



<img src="https://img.shields.io/badge/김강현-FF7F7F?style=for-the-badge&logo=googlebard&logoColor=darkgray" /><br/>
[blog](blog.naver.com/dnf___) [Github](koju2005 (github.com))<br/>



<img src="https://img.shields.io/badge/김민석-58A616?style=for-the-badge&logo=googlebard&logoColor=darkgray" /><br/>
[blog](https://bastian0748.tistory.com/) [Github](https://github.com/ms0753)<br/>

### ※ 개발기간 : 2023.10.23 ~ 2023.12.15

### ※ 기술스택
<img src="https://img.shields.io/badge/CSharp-512BD4?style=flat&logo=csharp&logoColor=white" />
<img src="https://img.shields.io/badge/Unity-000000?style=flat&logo=unity&logoColor=white" />
<img src="https://img.shields.io/badge/VisualStudio-5C2D91?style=flat&logo=visualstudio&logoColor=white" />
<img src="https://img.shields.io/badge/Github-181717?style=flat&logo=github&logoColor=white" />
<img src="https://img.shields.io/badge/FIGMA-F24E1E?style=flat&logo=figma&logoColor=white" />
<img src="https://img.shields.io/badge/Notion-F8F2E9?style=flat&logo=notion&logoColor=white" />

### ※ 세부기획 및 개발진행과정
<https://www.notion.so/IT-61c7dee87a824a3e8dbda924f1e2fa55>

---


  # 2️. 프로젝트 소개
### ※ 게임 소개
이세계 트럭에 치여 눈을 떠보니 이세계 한복판이다. 현실 세계로 돌아가기 위해서 거대한 몬스터들이 숨긴 유물을 모아 마법사에게 전해주어야 한다.
과연 평범한 사람인 주인공은 험난한 이세계에서 그리운 현실로 돌아갈 수 있을까?

![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2Ff0e2b438-266e-42f5-9909-6d909e2b5d5e%2F%25EA%25B2%258C%25EC%259E%2584UI%25EC%2584%25A4%25EB%25AA%2585.png?table=block&id=98cc63b4-df7e-453a-b9b3-e58ecdc569ed&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=2000&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)
![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F333c8568-86bf-49a8-b56d-aaa0b146c7f8%2F%25EC%25A1%25B0%25EC%259E%2591%25EB%25B2%2595.png?table=block&id=149704dc-6018-4626-9fbc-cc2ceca607f9&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=870&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)

플레이어는 이세계의 4마리 거대한 보스가 지키고 있는 유물을 모아와야만 현실세계로 돌아가는 포탈을 만들 수 있습니다.
넓은 필드를 탐험하며 보스를 물리치고 유물을 모아보세요!
![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F4d53a73e-61e8-4d18-ac33-d36aa28d2feb%2FwormBoss.png?table=block&id=baa7c282-0f68-4c83-a621-d710ca0bed19&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1610&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)
![iamge](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F07558983-6d79-4f54-81b1-c6b39c192640%2FbirdyBoss.png?table=block&id=82570931-f653-44e1-931d-92fc0ad0a5e8&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1630&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)
![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F72e13f31-8caa-4326-b684-7c2a2080a68e%2FflowerBoss.png?table=block&id=6e3bb564-00f1-47d5-a7a3-18f92209726c&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1600&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)
![iamge](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F2376745e-fba2-468c-9b5d-b4ef93cfc735%2FtreantBoss.png?table=block&id=5b437de7-6b25-40ae-b2ec-509d906070f2&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1590&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)
![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F4ea8269b-f12d-4d9a-b4bf-1c8b168abc50%2F%25EC%259C%25A0%25EB%25AC%25BC.png?table=block&id=a4f6bbd5-4fa0-4b64-9fbc-ac447a61bdf5&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1480&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)


필드에는 다양한 아이템들이 존재합니다. 열심히 재료를 모아서 모험에 필요한 장비를 제작하거나 상점에 교환하여 골드를 벌 수 있습니다. 
마을 안팎으로 존재하는 다양한 NPC들과 상호작용을 해보세요!
![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F013fedd0-c495-4918-ae63-5deef4b97878%2Fitemspawn.png?table=block&id=9afe1cfd-0e57-4ad9-8ade-c129e0af40ca&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1610&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)
![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F9a1e5284-ff14-4095-a918-4c9945a96cc9%2Fcrafting.png?table=block&id=f594815e-1705-478f-ab1f-31c682582bea&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1620&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)
![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F03fabe1a-7c6c-437c-a069-3a65b2be52f6%2Fshop.png?table=block&id=301dbca0-4b8c-491c-8855-d9169d1400c0&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1610&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)
![image](https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F885f15d9-a878-4152-84bb-83b9cef9e7ca%2FNPC.png?table=block&id=261063fa-f035-420b-9b49-3031a0283309&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=1620&userId=ebb7fbff-4b26-4ecd-93fe-20e186c11681&cache=v2)


---

# 3️. 주요 기능 구현 방법
## Player
+ 플레이어는 FSM을 사용하여 구현하였고 물리적 계산은 Character Contorller & CapsuleCollider & RigidBody 사용
+ Callback 메서드를 사용하여 키 입력을 받아 해당 상태로 변환되도록 구현
```
protected virtual void AddInputActionsCallbacks()
    {
        PlayerInputSystem input = stateMachine.Player.Input;
        input.PlayerActions.Movement.canceled += OnMoveCanceled;
        input.PlayerActions.Run.started += OnRunStarted;
        input.PlayerActions.Jump.started += OnJumpStarted;
        input.PlayerActions.Attack.performed += OnAttackPerformed;
        input.PlayerActions.Attack.canceled += OnAttackCanceled;
        input.PlayerActions.SuperJump.started += OnSuperJumpStarted;
        input.PlayerActions.Throw.started += OnThrowStarted;
        input.PlayerActions.NoStamina.started += OnNoStaminaStarted;
        input.PlayerActions.Shield.started += OnShieldStarted;
    }

    protected virtual void RemoveInputActionsCallbacks()
    {
        PlayerInputSystem input = stateMachine.Player.Input;
        input.PlayerActions.Movement.canceled -= OnMoveCanceled;
        input.PlayerActions.Run.started -= OnRunStarted;
        input.PlayerActions.Jump.started -= OnJumpStarted;
        input.PlayerActions.Attack.performed -= OnAttackPerformed;
        input.PlayerActions.Attack.canceled -= OnAttackCanceled;
        input.PlayerActions.SuperJump.started -= OnSuperJumpStarted;
        input.PlayerActions.Throw.started -= OnThrowStarted;
        input.PlayerActions.NoStamina.started -= OnNoStaminaStarted;
        input.PlayerActions.Shield.started -= OnShieldStarted;
    }
```

+ 플레이어의 상태에 필요한 데이터 값은 ScriptableObject로 구현
```
public class PlayerSO : ScriptableObject
{
    [field: SerializeField] public PlayerGroundData GroundedData { get; private set; }
    [field: SerializeField] public PlayerAirData AirData { get; private set; }
    [field: SerializeField] public PlayerAttackData AttackData { get; private set; }
}
```

+ 플레이어의 UI와 연결된 컨디션들은 일반적인 Class로 구현하여 값이 저장되지 않도록 함

---


## Monster AI
+ 상황에 따른 상태 전환
플레이어와의 거리에 따라 거리가 멀어지면 연산 자원을 소비하지 않도록 동작을 멈추는 비활성화 상태로 전환
```
private void CheckTargetDistance()
    {
        if (Time.time - lastCheckTime > activationCheckDelay)
        {
            CalculateTargetDistance();
            if (TargetDistance <= activationDistance && !isActive)
            {
                isActive = true;
                SetActive(true);
            }
            else if (TargetDistance > activationDistance && isActive)
            {
                isActive = false;
                SetActive(false);
            }
            lastCheckTime = Time.time;
        }
        else
        {
            if (isActive)
                CalculateTargetDistance();
        }
    }
```

+ 편집, 재사용이 용이한 공격패턴
ScriptableObject를 사용해 에디터 상에서 편집 용이, 적의 종류에 상관없이 같은 공격 패턴 사용 가능
```
public override void Update()
    {
        base.Update();
        if (agent.remainingDistance < 0.1f)
            stateMachine.ChangeState(stateMachine.IdleState);
    }
    private Vector3 GetWanderLocation()
    {
        Vector3 currentPosition = agent.transform.position;
        NavMeshHit hit = new NavMeshHit();
        float destinationDistance = 0f;
        int i = 0;
        while (destinationDistance < enemyData.MinWanderDistance)
        {
            NavMesh.SamplePosition(currentPosition + (OnUnitCircle() * Random.Range(enemyData.MinWanderDistance, enemyData.MaxWanderDistance)), out hit, enemyData.MaxWanderDistance, agent.areaMask - NavMesh.GetAreaFromName("Walkable"));
            destinationDistance = Vector3.Distance(currentPosition, hit.position);
            // 과도한 샘플링 방지
            i++;
            if (i >= 20)
                break;
        }
        return hit.position;
    }
```

+ 애니메이션과 일치하는 공격 이펙트
공격 판정 및 이펙트가 애니메이션의 지정한 시점에 실행되도록 커스터마이징 가능

+ 공격 범위에 따른 AOE효과
공격 범위에 따라 사각, 부채꼴, 원형으로 바닥에 AOE 효과를 표시해 범위의 가시성 적용

---

## Inventory
+ MVC패턴과 event를 사용하여 Manager에서 Data저장 및 Controller의 처리 기능과 뷰 기능 호출 가능
  (Inventory Manager는 Singleton 및 DontDestroyOnLoad로 구현되어 있어 데이터 보존과 접근성 상향)

+ Inventory는 ScriptableObject의 값을 수정할 확장성과 데이터 양에 따른 속도 저하 고려하여 Dictionary로 구현


+ 아이템 추가 메서드에 Overloading을 사용하여 다양한 방식으로 아이템을 추가 및 반환 가능
```
public bool TryAddItem(int id, int count)
    {
        bool isTrue;
        if (count > 0)
            isTrue = IsCheckSpace(id, count);
        else
            isTrue = IsCheckItem(id, count);

        if (!isTrue)
            return isTrue;

        if (itemDB.GetItemData(id, out ItemData newItem))
        {
            if (id == 5000)
                isTrue = AddList(itemDics[3], count, 3, in newItem);
            else
            {
                int newItemType = (id / 100000) % 10;
                if (count >= 0)
                    isTrue = AddList(itemDics[newItemType], count, newItemType, in newItem);
                else
                    isTrue = SubList(itemDics[newItemType], count, newItemType, in newItem);
            }
        }
        if (isTrue)
        {
            AddItem?.Invoke(id, count);
        }
        return isTrue;
    }
```
  
---

## NPC & Quest
+ NPC의 데이터를 가지고 있는 클래스를 구현해 NPC를 ID값으로만 관리

+ 퀘스트 데이터들은 액셀 데이터를 Scriptable Object로 변환 후 QuestManager 내에 해당 퀘스트번호를 가진 딕셔너리 자료형으로 구현
  (특정한 퀘스트가 존재할 때 무조건 하나만 존재해야 하기 때문에 중복되지 않는 Key&Value 값으로 구성
```
private void InitDB()
    {
        for (int i = 0; i < ServeQuestDB.Sheet1.Count; i++)
        {
            questDBDic.Add(ServeQuestDB.Sheet1[i].id, ServeQuestDB.Sheet1[i]);
            playerQuest.Add(ServeQuestDB.Sheet1[i].id, 0);
            if (ServeQuestDB.Sheet1[i].QuestType == 2)
            {
                if (ServeQuestDB.Sheet1[i].QuestMonster > 0)
                {
                    playerQuestKillCount.Add(ServeQuestDB.Sheet1[i].id, 0);
                }
                if (ServeQuestDB.Sheet1[i].QuestMonster2 > 0)
                {
                    playerQuestKillCount2.Add(ServeQuestDB.Sheet1[i].id, 0);
                }
            }
        }
    }
```

---

## UI
+ UI를 조작하는 중에는 기존의 마우스 입력을 받던 카메라와 플레이어의 동작 정지

  
+ 모든 UI가 UIManager에서 생성 및 참조, 관리가 되도록 구현

  
+ Observer 패턴
플레이어가 게임을 진행중에 변경된 값이 UI에 전달 및 UI가 업데이트 되도록 구현
UI는 값만 입력받거나 확인하여 작동하기에, 느슨한 결합으로 객체간 의존성을 낮춤
---


# 4. 프로젝트 결과 및 성과
+ 자유도가 높지만 확실한 목표 → 비선형적 진행구조 + 이세계 탈출이라는 최종 목표 부여
+ 방대한 월드에 다양한 재미 요소 → 맵 곳곳에 배치된 NPC와 서브 퀘스트 및 채집으로 탐험으 재미 부여
+ 전투는 존재하되 현대인 컨셉을 살려 직접 전투는 최소화 → 보스 몬스터와의 전투는 환경요소인 기믹을 활용하여 색다른 전투 구현
+ 플레이를 통해 성장하는 재미 부여 → 제작 시스템, 스탯 성장 시스템
+ 성장 과정에 지루하지 않도록 미니게임 추가 → 다양한 미니게임을 통해 성장 과정에서 긴장감 부여

